---
title: 服务操作
summary: 服务端口与域名管理
toc: true
asciicast: true
---

## 服务端口与域名管理

### 1.1 服务端口管理

端口相关的管理包含，端口号，端口协议，端口访问控制、对内服务端口变量设置等操作，下图是不同团队、不同端口的服务开启了不同访问控制后的示意图：

<img src="https://static.goodrain.com/images/docs/3.6/user-manual/manage/port-manage.png" width="100%" />


#### 端口号设置

服务端口与容器内部程序监听的端口是完全对应的关系，也就是说，当程序启动后监听的端口是80，那服务的端口就应该设置为80。

可以通过【添加端口】功能为服务添加其他的端口，需要确保添加的端口与程序监听的端口一致，并选择对应的端口协议。

#### 端口协议
端口可以指定不同的协议类型，目前Rainbond支持 `HTTP`、`TCP`、`UDP`和 `MySQL` 协议，请确保选择的协议与你程序监听的协议一致。

协议的选择会影响服务的后续操作：

- 性能分析功能
> 不同协议的服务启动了`性能分析插件`后，其性能分析的方式会有所不同，如HTTP协议会分析HTTP相关的数据，MySQL协议会分析MySQL语句相关的数据。

- 打开对外服务后的访问
> 当端口打开对外服务后，HTTP协议会<b>分配默认的域名</b>，非HTTP协议会<b>分配IP+端口</b>的访问方式

#### 端口访问控制

端口的访问控制分为两类：

- 对内服务
> 开启租户网络内部的访问许可，这时，该团队内部的服务可以通过【添加依赖服务】的方式访问到该服务。

- 对外服务
> 打开对外服务后，平台会将该<b>服务映射的端口添加到全局负载均衡</b>，这时<b>平台外部</b>以及<b>平台内部其他团队的服务</b>都可以通过负载均衡分配的域名或IP访问到该服务。

{{site.data.alerts.callout_info}}

- 修改端口信息后需要更新服务。
- 端口打开对内服务后，其他服务要想连接到该服务，需要先【添加依赖服务】建立关联，然后通过<b>连接地址或环境变量</b>连接。
- 端口访问控制可以根据需要开启和关闭，可单独开启，也可以全部开启，如果服务是个worker程序，只需要连接别的服务，本身没有端口监听就没有必要开启端口访问。

{{site.data.alerts.end}}

### 1.2 服务域名管理

Rainbond为每一个HTTP服务自动生成一个默认的域名，一般情况下这个域名都比较长，不方便记忆。你可以通过下面两种方式修改默认域名：

- 修改默认域名：修改服务默认生成的域名前缀，主域名是安装云帮时生成或指定的。
- 绑定新域名：为服务指定一个新域名，绑定完成后，需要在你的DNS域名服务商的那里设置一下<a href="https://baike.baidu.com/item/CNAME" target="_blank">CNAME</a>记录。

