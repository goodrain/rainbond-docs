---
title: Envoy Smelting Limit Practice (ii) Rainbod based on the global stream of RLS services
description: Envoy can act as an agent in the Sevice Mesh Microservice Framework and Rainbond is also based on Envoy.The smelting practices described here are based on the implementation of Rainbond unique plugins mechanisms
slug: enovy2
image: https://static.goodrain.com/wechat/envoy-ratelimit/envoy.png
---

Envoy can act as an agent in the Sevice Mesh Microservice Framework and Rainbond is also based on Envoy.The smelting practices described here are based on the implementation of Rainbond unique plugins mechanisms.

## Envoy Global Speed

While in most cases the distributed melting breakers are very effective in controlling the throughput in the distribution system, it sometimes does not work well and requires a global speed at this time.The most common situation is when a large number of hosts are forwarded to a small number of hosts and an average request is delayed for short periods (e.g. connections/requests sent to database servers).If the target host becomes a reserve, downstream hosts will crush upstream clusters.In such cases, it is difficult to configure enough smelters for each downstream host, allowing the system to operate smoothly, while cascade failures can still be prevented when the system starts to fail.In this case, global speed is a good solution.

Envoy Global Speed Program requires a global RLS service delivery based on a global RLS service designed as a Go/gRPC service that provides different speed scenarios for different kinds of applications.

![ratelimit-1](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-1.jpeg)

---

## Build Global Speed Service

An open box is a global speed service that has been included in the built-in open-source application store for Rainbond and can be based on the following one-click installation rate restriction service.

- **Access the built-in open source store**

> Select the **Marketplace** tab on the left, switch to the **Open Source Store** tab on the page. Search keywords for **Speed Limit**\*\* to find the Speed Limit Service.

![ratelimit-2](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-2.png)

- **One-Click Installation**

> Click on the speed limit to **Install** on the right side of the service to access the setup page, fill in simple messages, then click **OK** to start the installation, and the page automatically jumps to the top.

![ratelimit-3](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-3.png)

Argument Description：

| Select Item  | Note                                                                                                 |
| ------------ | ---------------------------------------------------------------------------------------------------- |
| Team Name    | Workspace created by the user to name space isolation                                                |
| Cluster name | Select which K8s cluster the rate limit service is deployed to                                       |
| Select app   | Select which app the rate limit service is deployed to include several related components in the app |
| App Version  | Select the version of the rate limit service, which is 1.4.0         |

After a few minutes, the speed limit service will be installed and running.

![ratelimit-4](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-4.png)

---

## Global Speed Configuration

Global limit standards can be configured by editing profiles `/data/ratelimit/config/config.yaml` in the `Rate-limit-service` component.

Default configuration content below：

```yaml
domain: limits. omton
descriptors:
  - key: remote_address
    rate_limit:
      unit: second
      requests_per_unit: 10

  # Black list IP
  - key: remote_address
    value: 50. .0.5
    rate_limit:
      unit: second
      requests_per_unit: 0
```

In this segment configuration, 10 requested speed configurations per second are defined for a domain name `domain`.

For client IP with `50.0.0.5`, 0 requested speed configurations are allowed per second and can be understood as blacklisted configurations.

For more configuration examples, see [GitHub - envoyproxy/ratelimit: Go/gRPC service designed to enable generic rate limits from different types of applications](https://github.com/envoyproxy/ratelimit#exams)

---

## Quote Global Speed Service

Requires a speed service component to meet the following conditions：

- Install and configure **Service Integrated Network Governance Plugins**

- Depends on `Rate-limit-service`

Rainbond has the ability to extend operations through the plugin mechanism, and it can be expanded at the network entrance to restricted operations by installing **Services Integrated Network Governance Plugins\*\*\*\*Service Integrated Network Governance Plugin** essentially extends Envoy's ability to achieve global speed by calling `Rate-limit-service`.

![ratelimit-5](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-5.png)

Make sure the `OPEN_LIMIT(whether or not to enable restricted streams)` option is `YES`,
`LIMIT_DOMAIN` (domain name of the applicable stream rules)` is consistent with the ``dominan` in the global restricted configuration above.To this end, the configuration of the restricted service side has been completed.

![ratelimit-6](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-6.png)

---

## Verify

In order to verify whether the limit is effective, the [Locust Pressure Test Tool](https://mp.weixin.qq.com/s/greebbqDh-a5JJJkfokh4Q) is introduced to generate an ongoing access request to the restricted operation.

![ratelimit-10](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-10.png)

With the application of the default global speed strategy, limited access to about 74% of the total by the limited operation under 40 RPS conditions.

![ratelimit-7](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-7.png)

Denied access, obtained 429 return codes and prompt `Too Many Requests`, a standard return mode for service speed.

![ratelimit-8](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-8.png)

The **Service Integrated Network Governance Plugins** installed by Speed Operations supports dynamic configurations.This means that if the service is not stopped, only `OPEN_LIMIT' option will be `NO\` and the configuration will be updated and the service limit will be turned down. The number of access errors will be reduced to 0.

![ratelimit-9](https://static.goodrain.com/wechat/envoy-ratelimit/envoy-ratelimit-9.png)

The global speed is effective at the web entrance of the restricted operation, which means that requests are limited regardless of whether they are requested from other microservice components deployed by Rainbond or from external access outside the gateway.

---

## Summary

Global speed is an effective means of protecting micro-services in sudden traffic surge scenarios, and Rainbond built-in Microservice Framework supports the Envoy Service Speed Program that meets RLS specifications.The configuration is simple, and supports dynamic change, and the examples in this paper seek to show, in an intuitive manner, the deployment practice of a global speed in the Rainbond system.
