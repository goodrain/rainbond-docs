---
title: eBPF Cilium War (2) - Bottom network detectable
description: Cilium is based on a new Linux nuclear technology called BPF, which can insert strong security, visibility, and network control logic inside Linux dynamically
slug: CiliumTwo
image: https://static.goodrain.com/wechat/cilium/cilium.png
---

In previous platforms, there were no direct observability of network flows between components, and there were problems in communication between user components, which could be manually checked only through traditional command-line tools, while the cilium's Hubble service could provide UI for users to display real-time traffic state, while these indicators could be exposed to Prometheus for aggregation to allow users to observe bottom network status more visually.

## Enable Hubble UI Service

The network observability is provided by the Hubble service and will not install Hubble by default while installing it. Hubble services can be enabled by the following commands:

```bash
helm upgrade cilium cilium/cilium --version 1.11.2 \
   --namespace kube-system \
   --reuse-values \
   --set hubble.relay.enabled=true \
   --set hubble.ui.enabled=true
```

Once deployed, status can be determined by following command

```bash
$ kubectl get po -n kube-system |grep huble
hubble-relay-65ff5f9bf6-247pt 1/1 Running 0 5d19h
hubble-ui-5f7cdc86c7-gq5hs 3/3 Running 0 5d19h
$ kubtl get svc -n kube-system | grep ubble
hubble-rely ClusterIP 10. 3.73.95    <none>        80/TCP 5d19h
hubble-ui ClusterIP 10. 3.20.190   <none>        80/TCP 5d19h
```

Once Hubble deployed, the cluster cannot be accessed directly. External access can be enabled by

- On temporary

  The UI interface can be accessed via `IP:12000` when executing command. You cannot continue to access it after exiting command

  ```bash
  cilum hubble ui
  ```

- Long On

  Enable or disable the UI access entry at any time by adding a third party component to the Rainbond platform

  ![](https://static.goodrain.com/wechat/ilium/2/1.png)

  ![](https://static.goodrain.com/wechat/ilium/2.png)

  ![](https://static.goodrain.com/wechat/ilium/2/3.png)

## Hubble UI Display Information

Visit home page

![](https://static.goodrain.com/wechat/ilium/2/4.png)

Enter the name space that needs to be viewed, show current traffic tops in the middle of the page, show traffic records at the bottom

![](https://static.goodrain.com/wechat/ilium/2/5.png)

Tap traffic to see details

![](https://static.goodrain.com/wechat/ilium/2/6.png)

Show only relevant traffic after clicking on the component

![](https://static.goodrain.com/wechat/ilium/2/7.png)

Select the information column displayed in the traffic record

![](https://static.goodrain.com/wechat/ilium/2/8.png)

Select the type of traffic to display

![](https://static.goodrain.com/wechat/cilium/2/9.png)

Whether or not to ignore special types of traffic when selecting the display

![](https://static.goodrain.com/wechat/ilium/2/10.png)

## Glass Prometheus and Grafana

ilium provided yaml documents for the deployment of Prometheus and Gramana, which contained template documents from gramana, but no open monitoring indicators were installed by clone and needed to start up monitoring indicators and deploy Prometheus and Grafana

Enable monitoring indicators

```bash
helm upgrade cilium ilium/cilium --version 1.11. \
   --namespace kube-system \
   --reuse-values
   --set prometheus. nabled=true
   --set operator. rometheus.enabled=true \
   --set hubble.enabled=true
   --set hubble.metrics.enabled="{dns,drop,tcp,flow,port-distribution,icmp,http}"
```

Deployment of Prometheus and Grafana

```bash
$ kubtl apply-f https://raw.githubusercontent.com/ilium/ilium/111.2/example/kubernetes/addons/prometheus/monitoring-example. aml
namespace/cilium-monitoring created
servicesaccount/prometheus-k8s created
configmap/grafana-config created
configmap/grafana-clicium-dashboard created
configmap/grafana-ilium-operator-dashboard created
configmap/grafana-hubble-dashboard created
configmap/prometheus created
clusterrole. bac.authorization.k8s.io/prometheus unchanged
clusterrolebinding.rbac.authorization.k8s.io/prometheus unchanged
service/grafana created
service/prometheus created
employment.apps/grafana created
employment.apps/prometheus created
```

Confirm Running Status

```bash
$ kubectl get po -n cilium-monitoring
NAME                          READY   STATUS    RESTARTS   AGE
grafana-d69c97b9b-5ztrj       1/1     Running   0          5d20h
prometheus-655fb888d7-456n4   1/1     Running   0          5d20h
$ kubectl get svc -n cilium-monitoring
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
grafana      ClusterIP   10.43.230.15    <none>        3000/TCP   5d20h
prometheus   ClusterIP   10.43.219.180   <none>        9090/TCP   5d20h
```

Enable External Access

- On temporary

  ```bash
  kubtl -n couple-monitoring port-forward service/gramana --address 0.0.0.0 --address:: 3000:3000
  kubectl -n celli-monitoring port-forward service/prometheus --address 0.0.0.0 ---address :: 90900:9090
  ```

- Long On

  ![](https://static.goodrain.com/wechat/cilium/2/11.png)

  ![](https://static.goodrain.com/wechat/cilium/2/12.png)

  ![](https://static.goodrain.com/wechat/cilium/2/13.png)

  ![](https://static.goodrain.com/wechat/cilium/2/14.png)

Grafana Display Information

Cilium Metrics

![](https://static.goodrain.com/wechat/ilium/2/15.png)

Cilium Operator

![](https://static.goodrain.com/wechat/ilium/2/16.png)

Hubble

![](https://static.goodrain.com/wechat/ilium/2/17.png)
