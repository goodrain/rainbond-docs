---
title: Scan Maven on Rainbond using SonarScanner static
description: Static scanning of codes is a very common code quality assurance tool that not only can detect defects in the code, apply best practices from a variety of industries, but also identify safety gaps, give project code upgrades across the board
slug: sonarqube
image: https://static.goodrain.com/wechat/sonarqube/images.png
---

Static scanning of codes is a very common method of code quality assurance that not only does it detect defects in the code, apply best practices from a wide range of industries, but also identify safety gaps and give project code upgrades.Of the various code scanning programmes, SonarQube is the most familiar and the most widely applied.Various ongoing integration schemes have their own way of integrating SonarQube into static scanning of code.

A method based on the static scanning of Java Maven project by SonarScanner in the Rainbond source building process is presented today.

## SonarScanner For Maven Introduction

Use SonarScanner for Maven for code static scanning of the Maven project, which is the default scanner recommended by SonarQube.Just add the specified parameter to the mvn command, you can integrate the scanner and analyze the code loopholes in the build process.

Sample command：

```bash
mvn clean sonar:sonar -Dsonar.login=myAuthenticationToken
```

In practice, `myAuthenticationToken` will be replaced by a token generated by the actual user itself in SonarQube.

## Integrate into the continuum

Once SonarScanner for Maven works we can try to scan the process into the automated continuum chain of Rainbrond.**The effect we want to achieve is to automatically trigger the construction of the project after the code has been submitted, perform a scanning analysis of the code during the process and generate a report accordingly.**

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-1.png)

The entire process can be summarized as the following stages：

1. The developer submits the code to the repository and triggers the entire continuum chain.
2. The repository uses Webhook to call the Openapi interface of Rainbond to trigger corresponding service components to build itself.
3. Rainbond automatically builds counterpart service components, triggers SonarScanner scanning and sends the results to SonarQube service.
4. SonarQube service analyses scanned results and generates code detection reports.
5. The developer read the code detection report and was informed of improvements.
6. The developers refine the code based on the report and resubmit it back to step 1 to form a closed-loop for continuous integration.

This will be followed by the implementation of the above chain of continuous integration from an operational point of view based on Rainbond at a point.

### Prerequisite

The chain of continuous integration that includes code scanning is presented here and is based on the Rainbond Native Management platform.So the user needs to prepare for the sainbond environment that needs to be connected to the public network to prepare for the use of open source shops.

### From SonarQube

In addition to Rainbond native application management platform, there is a need to prepare code repositories and SonarQube services.The former we choose to use Gitlab, while the SonarQube service can be installed directly on the open source store.The Open Source Store currently provides SonarQube version 8.9.9 (lts) for user one-click installation.

The user can only select an open source store on the application market interface of Rainbond and search for `sonarqube` to find the installation entry：

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-2.png)

By clicking on the installation, select the installation location, you can install the SonarQube service and Postgresql database at the specified location.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-3.png)

访问 SonarQube 的对外服务端口，即可进入它的登录页面 ，默认的用户名和密码为： `admin / admin` 。

> If users do not yet have their own repositories, they can follow similar processes and install Gitlabs based on open source apps.

### Generate AuthenticationToken

In SonarQube, each user can generate `AuthenticationToken` as a communication token, using SonarScanner to verify their identity with SonarQube services.

Here we generate `Administrator` for the `AuthenticationToken` that scan Java Maven project.

When logged in as admin users, the token can be generated by switching to the **Security** tab on the **My Account** page.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-4.png)

Copy the created `AuthenticationToken`, it will only appear once!

### Build Maven from Gitlab

Rainbond can build projects in Gitlab based on Oauth2.0 versus the Gitlab repository and can be easily selected to build items in Gitlab and automatically configure the code automatically.

See document：[Rainbond with Gitlab pair](https://www.rainbond.com/docs/use-manual/enterprise-manage/enterprise-settings/base/oauth2.0/)

A standard Java Maven project code already exists in the Gitlab I use.You can search for items you want to deploy by clicking on the build component based on the source code. Select the Gitlab.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-5.png)

When creating a component, an auto-build switch can be enabled, which is equivalent to a code push switch configured to trigger automatic build.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-6.png)

Once you click on confirm to create, you will complete the check of the code language. At this time enter advanced settings, click on the left deployment properties, we need to make some advanced settings to match SonarScanner.

需要进行的设定包括：声明 SonarQube 服务的地址，对应账户的  `AuthenticationToken` ，以及添加了代码扫描步骤的构建命令。

### Configure Settings.xml

SonarScanner general configuration, including SonarQube Service Address, and `AuthenticationToken` can be configured in Settings.xml global configuration for use in Java Maven project construction.

Rainbond provides Settings.xml for globally active access configuration when constructing a project of Java Maven type.In advanced settings - Deploy properties, you can edit default Settings.xml by clicking **Manage Maven configuration**.Here we have provided a default configuration, we need to add the following configuration under xml format to define SonarQube Service Address, and `AuthenticationToken`.

```xml
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <pluginGroups>
    <pluginGroup>org.sonarsource.scanner. aven</pluginGroup>
  </pluginGroups>
  <profiles>
    <profile>
      <id>sonar</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <sonar.host.url>
          http://9000. rb63fe.duaqtz0k.17f4cc.grapps. n
        </sonar.host.url>
        <sonar.login>
          c1041c2b4ac2e89d1f5f5f5b5971bc8dc85b7
        </sonar.login>
      </properties>
    </profile>
  </profiles>
</settings>
```

Of course, users can also create a dedicated Settings.xml configuration, which I named `sonar-scanner` in my environment.Global configuration needs to be defined only once.

### Modify build command

SonarScanner For Maven scan code by adding specific parameters to the mvn command.

In the Maven build command input, change the command below：

```bash
crean verify sonar:sonar -Dsonar.projectName=Maven-demo -Dsonar.projectKey=Maven-demo install
```

For each of the different items, customize the value `-Dsonar.projectName` -Dsonar.projectKey \`.The former defines the name of the project in the SonarQube service and the latter defines the unique ID of the project.

### Start first build

SonarScanner currently in use requires JDK version higher than 1.8.Here we choose OpenJDK 11, because this version is another long-run version after 1.8.

To date, the build source information page should reflect the following：

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-7.png)

Click on confirmation to jump the page to the first build process.Wait a minute, build will be finished, code will be automatically packaged and online, and build logs will be viewed to see the analysis step： in the build process.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-8.png)

The address mentioned in the access log can be seen in the SonarQube service for new reports.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-9.png)

### Analysis of code

The developer refers to the report provided by the SonarQube service to learn about the current code.The SonarQube report provides best practices for the industry to fix the gaps.In the case of my project, 2 bugs were scanned, and 4 security issues were scanned.In one of these bugs for example, SonarQube gave a very detailed hint including a reasonable code prompt.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-10.png)

### Update Iteration Code

The developer will automatically trigger project construction and a new round of code scanning based on analyzed reports, fix the code, submit the code again and include key words in the code submission.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-11.png)

The `@deemploy` contained in the Commit Message is the keyword that triggers automatic construction.For more information about Rainbond auto build, please refer to document [Rainbond自动构建](https://www.rainbond.com/docs/use-manual/component-management/build-source/auto_build)

Wait for the project to be automatically constructed, review the analysis report again to determine if the bug has been resolved.

A review of the record of operations of components in Rainbond reveals the difference between manual building and automatic build.

![](https://static.goodrain.com/wechat/sonarqube/sonarqube-workflow-12.png)
