---
title: Define Rainbond Progress General DNS Resolution Mechanism
description: Rainbond itself with a distributed gateway leading North-South network traffic
slug: ingress
image: https://static.goodrain.com/wechat/rainbond-gateway/rainbond-gateway.png
---

[Rainbond](https://www.rainbond.com/?channel=cnblog) as a cloud native application management platform with a distribution gateway rbd-gateway to channel North-South network flows.Unlike in the general Progress configuration, users need to define their own domain usage experience. Rainbrond's gateway strategy can generate domain name access strategies by one key, through which users can access the business system deployed on Rainbond immediately.This experience is very friendly under the development test scenario, and the article gives an idea of how this mechanism is being implemented.

## Gateway and Progress

Rainbond team developed a high-performance gateway component rbd-gateway to handle cluster North-South traffic as a cluster inner Congress Controller.It both supports L4 and L7 level protocols and enables advanced features like WebSocket by one key.When using it, a detail feature is very good when you can generate a domain name address that can be accessed by a single key.

![image-20211202142555295](https://tva1.sinaimg.cn/large/008i3skNly1gwzgzq8siij325i0dedhf.jpg)

The following format for this domain is known as：

```golang
http://<servicePort>.<service_alias>.<tenant_name>.17a4cc.grapps.cn/

- servicePort: 访问策略对应的目标端口名称
- service_alias: 当前服务组件的别名
- tenant_name: 当前团队的别名
- .17a4cc.grapps.cn: 当前集群的泛解析域名
```

In fact, this routing rule is defined by the corresponding ingress and service in Kubernetes.The entire access link can be summonses：

![](https://tva1.sinaimg.cn/large/008i3skNly1gwzkbrhzv2j31ie0u0q6w.jpg)

Enable **External Service** switch equal to generating the following resources：

```yaml
apiVersion: v1
kind: Service
metadata:
  labels:
    creator: Rainbond
    event_id: ""
    name: gr49d848ServiceOUT
    port_protocol: http
    protocol: http
    rainbond.com/tolerate-unready-endpoints: "true"
    service_alias: gr49d848
    service_port: "5000"
    service_type: outer
    tenant_name: 2c9v614j
  name: service-8965-5000out
  namespace: 3be96e95700a480c9b37c6ef5daf3566
spec:
  clusterIP: 172.21.7.172
  ports:
  - name: tcp-5000
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    name: gr49d848
  sessionAffinity: None
  type: ClusterIP
status:
  loadBalancer: {}
  
---

apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/weight: "100"
  generation: 1
  labels:
    creator: Rainbond
    service_alias: gr49d848
    tenant_name: 2c9v614j
  name: 3cf8d6bd89250eda87ac127c49694a05
  namespace: 3be96e95700a480c9b37c6ef5daf3566
spec:
  rules:
  - host: 5000.gr49d848.2c9v614j.17a4cc.grapps.cn
    http:
      paths:
      - backend:
          serviceName: service-8965-5000out
          servicePort: 5000
        path: /
status:
  loadBalancer: {}
```

## Auto-generate domain

For most developers, domain names are a scarce resource, and how to allocate domain names for their own uncertain progress rule is an uphill thing.After all, only if you have your domain name will you be able to take full control of its parsing rules and avoid endless changes to the `/etc/hosts` file.

Precious Kubernetes management tools on the market can generate service and Ingress resources in semi-automatic ways.This semi-automatic method specifies the user to use the graphing UI interface and then enter the necessary information to generate the yaml configuration file by the management tool itself and load it into Kubernetes.But for configured domain names, few tools can use the same experience as Rainbond

The key to achieving this good experience is to parse the use of domain names generally.

对泛解析域名最简单明了的解释就是：符合  `*.mydomain.com` 这一规则的任意域名，都可以解析到同一个 IP 地址上去。In the current usage scenario, we only need to parse a generic domain `*.17a4cc.grapps.cn` to the server's IP address where rbd-gateway is located, so you can configure the correct domain name for `Progress rule`.

![](https://tva1.sinaimg.cn/large/008i3skNly1gwzmi07jcnj30b60cat91.jpg)

Rainbond combines `Progress rule` with general parsing domain names at the product design level, automatically creating a global unique domain name for each service port.Also when the cluster is installed, register the parse record with the public DNS servers. Once the cluster is installed, all the domain names generated are resolvable by the public network only if PC clients can use the public network DNS service, then they can parse the domain name and access the specified service port.

Rainbond distinguishes different clusters through different three-tier domains (e.g. `17a4cc` in the current scenario.This relates to a feature of generic parsing domain names, the parse record of subdomain names, priority higher than the parse record of the parent domain.

```golang
===========================================
// 对两级泛解析域名注册解析记录
*.grapps.cn           =解析记录注册=> 1.1.1.1
*.17a4cc.grapps.cn    =解析记录注册=> 2.2.2.2
===========================================
===========================================
// 客户端解析结果
abc.grapps.cn         =解析 IP 地址=> 1.1.1.1
abc.def.grapps.cn     =解析 IP 地址=> 1.1.1.1
abc.17a4cc.grapps.cn  =解析 IP 地址=> 2.2.2.2     // 优先使用 *.17a4cc.grapps.cn 的解析记录
```
