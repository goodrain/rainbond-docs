---
title: Rainbod integrates ELK/EFK with plugins to enable log collection
description: This paper will introduce EFK：Elasticsearch, Filebeat and Kibana
slug: elk
image: https://static.goodrain.com/wechat/EFK/ELK.png
---

ELK is the initial, abbreviated：Elasticsearch, Logstash and Kibana for three open source projects.But later FileBeat can completely replace Logstah's data collection function and be lightweight as well.This paper will introduce **EFK:** Elasticsearch, Filebeat and Kibana

## Preface

ELK is the initial, abbreviated：Elasticsearch, Logstash and Kibana for three open source projects.But later FileBeat can completely replace Logstah's data collection function and be lightweight as well.This paper will introduce **EFK:** Elasticsearch, Filebeat and Kibana

Elasticsearch：distributed search and analysis engine features high scalability, reliability and manageability.Building on Apache Lucene to perform near-real-time storage, search, and analysis of large volume data.Usually used as the base search engine for some applications, with complex search features;

Kibana：Data Analysis and Visualization Platform.Use with Elasticsearch to search, analyze and display data in statistical charts;

Filebeat：Fileat is a lightweight transporter for forwarding and centralizing log data.Filebeat is installed on your server as a proxy to monitor log files or locations you specify, collect log events, and forward them to Elasticsearch or Logstash for indexing.

Learn how to run applications on Rainbond, collect application logs by enabling FileBeat plugin and send them to Elasticsearch.

## Integrate architecture

When collecting logs, you need to enable FileBeat plugin collection in the app. FileBeat collection logs have three ways：

1. Specify log path
2. Collect all container logs
3. Specify label auto discovery

Collect this text using the specified log path in a way that allows us to customize the collection of logs, etc.

We sent FileBeat make Rainbond [一般类型插件](https://www.rainbond.com/docs/get-start/concept/plugin?channel=itpub). After the app starts, the plugin also started and automatically collected logs from Elasticsearch, the entire process was free of intrusion into the container and extensive.The collection of other logs can be done in a similar way, with users implementing different log collection tools by replacing plugins.

The graph below shows the structure of collecting application logs and sending them to Elasticsearch using FileBeat plugin in Rainbon.

![image-20211223162213573](https://grstatic.oss-cn-shanghai.aliyuncs.com/wechat/EFK/es_archive.png)

## Plugin implements the original parsing

The Rainbod plugin system is part of the application model relative to Rainbond, which is primarily used to support the extension of the application container.Since there is greater commonality in the delivery of the tools, the plugin itself can be reused.Plugins must be bound to the application container in order to be operational in order to achieve a performance capability such as performance analysis plugin, network governance plugin, initialization type plugin.

Running environments with running plugins match the bound components with： in the following

- **Cyberspace** is a critical feature that allows plugins to listen and intercept component network traffic, set component local domain name parsing etc.
- **Storage Persistent Space** this feature allows file exchange between plugins and components via persistent directory.
- **Environment variables** this feature allows the plugin to read the environment variable of the component.

During the creation of FileBeat plugin, **Generic Type Plugins** are used, which can be understood as a POD starting up two Containers, Kubernetes support the launch of multiple Containers in a POD, but is relatively complex in configuration, using the plugin to make users easy in Rainbod.

## Install EK via Rainbond Store first click

We have made elasticsearch + Kibana an app and posted to the Marketplace. Users can install it on the open source store.

1. Install Rainbond
2. Search elasticsearch in open source shops. Click install to install one key.

![image-20211223163856435](https://grstatic.oss-cn-shanghai.aliyuncs.com/wechat/EFK/es_store.png)

![image-20211223164246240](https://grstatic.oss-cn-shanghai.aliyuncs.com/wechat/EFK/es_topology.png)

3. `elasticsearch` is enabled by default to protect our cluster, so we need an initialized password.We run the `bin/elasticsearch-setup-passwords` command in the `elasticsearch` terminal to generate the default username and password：

```shell
bin/elasticsearch-setup-passwords 参数
auto 自动生成
interactive 手动填写
```

4. In the environment variable in the `Kibana` component, modify the environmental variable `ELASTICSEARCH_PASSWORD` that is linked to `elasticsearch`.

## Collect application logs

Use Nginx as a demo app to create components on Rainbond,

- Mirror address：`nginx:latest`
- Mount storage：`/var/log/nginx` to perpetuate the Nginx log. Fileat plugin can be read to the log file.

**Create FileBeat plugins**

Enter the plugin interface after clicking the plugin on the Rainbod team interface, click on the new plugin to create a generic type plugin.

- Mirror address：docker.elastic.co/beats/fileat:7.15.2
- Other custom is sufficient.

![image-20211223165325136](https://grstatic.oss-cn-shanghai.aliyuncs.com/wechat/EFK/create_plugin.png)

Create a plugin and build, we have enabled the FileBeat plugin in the Nginx component when it is built successfully.

Add FileBeat configuration in the Nginx component configuration as follows, and more are available at [官方文档](https://www.elastic.co/guide/en/beats/fileateat/current/fileat-reference-yml.html).

- Configuration file mount path：/usr/share/fileateat/fileat.yml
- Configuration File Permissions：644

```yaml
fileateat.inputs:
- type: log
  paths:
    - /var/log/nginx/*.log
output.elasticsearch:
  hosts: '127.0.0.1:9200'
  username: "elastic"
  password: "elastic"
```

**Build Dependencies**

Build Nginx dependency with elasticsearch so that it can communicate with `elasticsearch` via `127.0.0.1` to update the Nginx component for dependencies to take effect.

**Visit Kibana**

> Kibana Default Haliden

1. Tap `Stack Management` > Indexing to see that our `fileat` index already exists.

2. `Stack Management` > Indexing Mode, create `fileat` Indexing Mode.

3. The `Discover` page will see log information.

![image-20211223180227267](https://grstatic.oss-cn-shanghai.aliyuncs.com/wechat/EFK/discover.png)

## Summary

Based on Rainbond's plugin mechanism in conjunction with EFK, users can quickly collect the application log using the EFK`and have the flexibility to replace the plugin`FileBeat`with`Logstaash\`.

In addition, Rainbond has an open plugin to extend applications governance functions such as web governance classes, data back-class plugins and, without intrusion into the original application logic, allows performance analysis of services through web governance class plugins and log collection systems such as ELK; and backups of data using backup plugins for components, such as databases.
