---
title: 高级环境变量配置
description: Rainbond关于环境变量的一些高级用法，适合于开发者参考，使应用可以有效的与平台产生互动。
---

组件的运行环境除了用户自己设置的环境变量以外，平台还会默认注入一些有用的环境变量。另外，一些实验性质的新功能也可能基于设置特殊的环境变量的开启或设置。因此，了解 Rainbond 默认的环境变量机制可以使开发者在诸多场景中更高效的开发，也能生产出更适合 Rainbond 运行的应用。

### 默认注入的环境变量

> 一般是根据组件的相关属性注入相关的变量，以方便开发者获取组件相关的信息。

| 变量名              | 变量值                                                     | 说明                                                                             |
| ------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------------- |
| PORT                | 应用设置的第一个端口号                                     | 应用建立端口监听时尽量获取 PORT 环境变量值进行监听                               |
| PROTOCOL            | http\tcp\mysql 等                                          | 对应上述端口的协议类型                                                           |
| TENANT_ID           | 租户 ID                                                    | 租户 ID                                                                          |
| SERVICE_ID          | 应用 ID                                                    | 应用 ID                                                                          |
| MEMORY_SIZE         | micro， small， medium， large， 2xlarge 等,对应关系见下文 | 表示当前应用实例的内存大小设置，一般用于应用内存相关设置的初始化，例如 JAVA_OPTS |
| SERVICE_POD_NUM     | 应用实例数量                                               | 应用实例的数量                                                                   |
| DEPEND_SERVICE      | serviceAlias:serviceID,                                    | 依赖的应用                                                                       |
| HOST_IP             | ip 地址                                                    | 组件运行时所在宿主机 IP 地址                                                     |
| POD_IP              | ip 地址                                                    | 组件运行时的 IP 地址                                                             |
| DISCOVER_URL        | http://xxxxxxx/v1/resources/xxx                            | 配置发现接口地址,插件运行环境有效                                                |
| DISCOVER_URL_NOHOST | /v1/resources/xxx                                          | 不带 IP 地址的配置发现 URL, 地址使用 HOST_IP：6100                               |

- 组件实例内存设置大小与 MEMORY_SIZE 环境变量值的关系

  > 程序获取当前组件设置的内存大小是非常有益的，比如 Java 的 JVM 配置，PHP 的 fpm 配置等，一些需要设置内存的内部中间件最好可以与组件本身内存设置协同，否则可能出现 OOM 或者内存浪费的情况。

  > | 内存/Mb | 环境变量值 |
  > | ------- | ---------- |
  > | 128     | micro      |
  > | 256     | small      |
  > | 512     | medium     |
  > | 1024    | large      |
  > | 2048    | 2xlarge    |
  > | 4096    | 4xlarge    |
  > | 8192    | 8xlarge    |
  > | 16384   | 16xlarge   |
  > | 32768   | 32xlarge   |
  > | 65536   | 64xlarge   |

* 域名自动注入的环境变量说明:

应用默认注入当前组件的访问域名环境变量信息：DOMIAN 和 DOMAIN_PROTOCOL，如果组件具有多个端口，注入策略如下

1.如果有多个端口, 则会在环境变量名后面加上`_端口号`, 即`DOMAIN_端口号`. 比如: DOMAIN_80, DOMAIN_8080

对应的域名协议则为 DOMAIN_PROTOCOL_80

2.DOMIAN 变量的值为组件端口号从小到大，自定义域名优先的值。比如有端口 80,8080,如果 8080 绑定了自定义域名，则 DOMIAN 的值为 8080 端口的自定义域名。如果都没有绑定自定义域名，则为 80 端口的默认域名。

### 构建组件时使用的变量

变量名以`BUILD_`开头的环境变量在源码构建类应用构建阶段生效，比如下述变量：

| 变量名                   | 变量值                                                                                     | 说明                        |
| ------------------------ | ------------------------------------------------------------------------------------------ | --------------------------- |
| BUILD_REPARSE            | true                                                                                       | 构建时重新识别代码语言类型  |
| NO_CACHE                 | true                                                                                       | 构建时不使用缓存包          |
| BUILD_MAVEN_CUSTOM_OPTS  | -DskipTests=true -Dmaven.wagon.http.ssl.insecure=true -Dmaven.wagon.http.ssl.allowall=true | 用于 maven 构建，默认值如前 |
| BUILD_MAVEN_CUSTOM_GOALS | clean install                                                                              | 用于 maven 构建，默认值如前 |

更多组件构建环境设置，请参考 [组件构建源配置](./index)

### 应用运行时功能控制变量

以`ES_`开头的环境变量将作为扩展功能变量，例如下面用例：

| 变量名                | 变量值          | 说明                                                                      |
| --------------------- | --------------- | ------------------------------------------------------------------------ |
| ES_SELECTNODE         | 选择宿主机的 ID | 用于定点调度，指定调度到某台宿主机上，节点的 ID 通过 grctl node list 可得 |
| ES_HOSTNETWORK        | true            | 是否使用主机端口映射,该变量请谨慎使用                                     |
| ES_HOSTNAME           | 主机名          | 设置实例的主机名，适用于单实例组件                                        |
| ES_CPULIMIT           | 1 核=1000       | 自定义组件的 CPU 限制值 5.0.3 及以后版本支持                              |
| ES_CPUREQUEST         | 1 核=1000       | 自定义组件的 CPU 请求值 5.0.3 及以后版本支持                              |
| ES_TCPUDP_MESH_MEMORY | MB              | 自定义默认的 MESH 容器内存限制量，默认为 128MB                            |
| ES_TCPUDP_MESH_CPU    | 1 核=1000       | 自定义默认的 MESH 容器 CPU 限制量，默认为 120, 最小为 120                 |
| ES_HOST_DOMAINNAME    | IP地址          | 自定义域名解析，在 /etc/hosts 生成对应 DOMAINNAME 到 IP地址 的解析记录       |
| ES_DISABLE_SIDECAR_CHECK | true         | 关闭 MESH 插件对依赖服务的端口检测，即使依赖组件对应端口未准备就绪，依然启动自身组件                                                       |

### 有效使用环境变量进行软件配置

云原生应用的 12 要素第三点：“代码和配置严格分离，配置要和代码完全分离，不同环境共享一套代码。推荐将应用的配置存储于环境变量中”。推荐将你的程序需要配置的部分尽可能的环境变量化。
