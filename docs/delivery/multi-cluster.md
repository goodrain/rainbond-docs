---
title: 多集群交付
---

本文主要介绍如何利用 Rainbond 实现多集群交付和管理。

## 准备工作

1. 同一个控制台下拥有两个隔离的集群。可参考[基于主机安装](/docs/installation/install-with-ui/)部署两个集群。当两个集群都完成对接后，你将在`平台管理->集群`中看到它们，此处我们假设两个集群名分别是`阿里云集群`和`腾讯云集群`。

2. [本地组件库镜像仓库](/docs/use-manual/enterprise-manage/enterprise-settings/base/component-registry)在两个集群中均可正常访问。本地组件库是发布时应用镜像同步的地址。只有这个地址能同时被`阿里云集群`和`腾讯云集群`访问到，才能正确拉取[应用模版](/docs/delivery/concept#rainbond-application-template)中的镜像。

3. 在`阿里云集群`中已有正常运行的应用，可参考[快速入门](/docs/quick-start/getting-started)。

## 发布应用模版

1. 在`阿里云集群`中正常运行的应用中，我们在应用拓扑图页面左侧，选择 `发布->发布到组件库`， 即可进入模版设置页面。各个参数详细说明参考[附录1: 模版设置页面参数说明](/docs/delivery/multi-cluster#template-setting)

2. 新建一个应用模版，可选择发布范围为企业，设定好发布的版本，点击`提交`，接下来将会同步所有组件的镜像，推送到本地镜像仓库中。同步完成后，点击`确认发布`，即发布完成。接下来在 `平台管理->应用市场->本地组件库`，即可看到发布好的应用模版。

:::caution
注：仅有企业管理员可以看到平台管理按钮。
:::

## 在另一个集群中部署和管理

1. 我们原始的应用运行在`阿里云集群`中，并且已经将其发布到了`本地组件库`中，此时我们可以在应用模版右侧，选择安装。

2. 新建一个团队，集群选择`腾讯云集群`。团队名称和团队英文名称自定义即可。

3. 新建团队完成后，可以选择`应用版本`，确认信息无误后，点击`确定`即可将示例应用在`腾讯云集群`中完整运行起来。

4. 此时，我们有了两个完全相同的应用，并且他们运行在不同集群中，均可以通过该控制台进行管理。

## 升级和回滚

1. 当我们对`阿里云集群`中的应用做了变更，新增了某些模块或者配置时，我们可以重新进行应用发布操作。在`阿里云集群`中正常运行的应用中，重新发布应用，选择之前已创建的应用模板，修改版本号，如之前版本设置为 2.9，则此次发布设置为 3.0。

2. 切回`腾讯云集群`对应的团队，进入之前部署的应用，在拓扑图页面，可以在页面右上处看见`待升级`,它展示了可以升级的模版数量，点击进入选择指定版本升级即可。

3. 在升级版本上线后出现异常情况需要回滚时，平台提供了一键回滚功能，在`升级->升级记录`界面选择对应记录点击回滚按钮即可对升级操作进行回滚。

:::caution
注：升级过程中不会变动环境配置类信息，环境变量的值、配置文件的内容、持久化存储需要人为改动才会生效。回滚的过程中，新增组件并不会被删除，如需变更，需要人为操作。
:::

---

## 附录1: 模版设置页面参数说明 {#template-setting}

### 1. 应用模版及发布版本设置

- 创建应用模版时参数说明：

| 选项名   | 说明                                                                         |
| -------- | ---------------------------------------------------------------------------- |
| 名称     | 定义应用名称（必填）                                                         |
| 发布范围 | 应用模板的可见范围，**当前团队**为当前团队可见，**企业**所有团队可见（必选） |
| 分类标签 | 应用标签，可按照架构、行业、部署方式进行分类                                 |
| 简介     | 应用描述，帮助使用者了解此应用                                               |
| Logo     | 应用的 Logo 图片                                                             |

- 创建应用模板后定义应用发布版本：

| 选项名   | 说明                                                                                                                           |
| -------- | ------------------------------------------------------------------------------------------------------------------------------ |
| 版本号   | 当同应用多次发布时，如果版本号相同，则会覆盖已发布的版本，如果不同，将发布为新版本，应用升级或回滚时，平台根据版本判断（必填） |
| 版本别名 | 应用别名，例如 高级版，初级版                                                                                                  |
| 版本说明 | 当前发布版本的说明，可区分不同版本的功能差异等信息                                                                             |
| 作为插件 | 当该应用模版下有插件时，选中该选项，则可以在`团队页面-插件-从本地组件库安装`，直接安装对应的插件而不安装应用                             |

### 2. 发布组件模型配置：

| 选项名   | 说明                                                                 |
| -------- | -------------------------------------------------------------------- |
| 连接信息 | 当连接信息中出现密码类的信息，可选择每次部署时自动生成随机值         |
| 环境变量 | 编辑该组件默认的环境变量                                             |
| 伸缩规则 | 定义该组件可伸缩的最大最小节点数，及节点伸缩步长，最小安装内存限制。 |

### 3. 发布插件模型信息：

要发布的应用中其组件携带有插件时，会进行展示并在发布过程中跟随组件发布。

### 4. K8s 资源：

要发布的应用中存在定义好的 K8s 资源时，也会进行展示并在发布过程中跟随应用发布。

所有信息配置完毕后，点击**提交**按钮进行发布，业务开发过程中定义的组件间依赖关系、环境配置、持久化存储、插件、运行环境及上述定义的所有信息都将会被打包发布。
