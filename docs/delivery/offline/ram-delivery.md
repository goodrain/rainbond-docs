---
title: 应用模版交付
---

本文将介绍如何使用 Rainbond 应用模版进行离线交付。

## 准备工作

1. 拥有两套 Rainbond 集群，模拟开发环境及交付环境(开发环境为在线环境，交付环境为离线环境)。

2. 开发环境安装，参考[快速安装](/docs/quick-start/quick-install)，交付环境安装，参考[离线安装](/docs/installation/offline/)。

3. 在开发环境已有正常运行的应用，可参考[快速入门](/docs/quick-start/getting-started)。

## 发布应用模版

1. 在应用拓扑图页面左侧，选择 `发布->发布到组件库`， 即可进入模版设置页面。各个参数详细说明参考[附录1: 模版设置页面参数说明](/docs/delivery/offline/ram-delivery#template-setting)

2. 新建一个应用模版，可选择发布范围为企业，设定好发布的版本，点击`提交`，接下来将会同步所有组件的镜像，推送到本地镜像仓库中。同步完成后，点击`确认发布`，即发布完成。接下来在 `平台管理->应用市场->本地组件库`，即可看到发布好的应用模版。

:::caution
注：仅有企业管理员可以看到平台管理按钮。
:::

## 导出应用模版

1. `平台管理->应用市场->本地组件库`中，在刚刚发布完成的应用模版最右侧，选择`导出应用模版`，你可以选择需要导出的版本，和导出哪种类型的包。这里我们选择`应用模型规范`，点击`导出`。这个包将包含应用完整的运维特性，用于持续交付和升级。

2. 导出完成后，将应用模版下载到本地，保存至U盘/光盘等移动存储设备中，带到离线交付环境中去。

## 离线环境中交付应用

1. 在已经部署好 Rainbond 的离线环境中，我们先打开`平台管理->应用市场`，选择`离线导入`，上传刚刚下载好的应用模版。上传完成后，点击`确认导入`。

2. 等待导入完成后，会自动跳转回`应用市场`。在导入完成的应用模版后，点击安装，即可一键部署该业务系统，该环境业务运行环境与开发环境完全一致，到此完成离线环境下的软件交付。

## 离线环境中增量升级

1. 软件在更新迭代过程中需要进行某些模块的升级，进行此类升级时即可使用增量升级来节省发布及导入导出时间。要达成增量升级的效果，需要重新进行应用发布操作。在开发环境中，重新发布应用，选择之前已创建的应用模板，修改版本号，如之前版本设置为 2.9，则此次发布设置为 3.0。

2. 在模版设置页面选择需要进行升级的组件进行发布，而不需要选择所有组件。发布完成后，导出新版本的应用模版离线包，在交付环境中再次导入。此时可以点击对应的应用模版看到所有版本。

3. 找到之前已交付的应用，在拓扑图页面，可以在左侧`升级`里看到可升级的版本。选择指定版本升级即可。

:::caution
注：升级过程中不会变动环境配置类信息，环境变量的值、配置文件的内容、持久化存储需要人为改动才会生效。
:::

## 一键回滚

1. 在升级版本上线后出现异常情况需要回滚时，平台提供了一键回滚功能，在`升级->升级记录`界面选择对应记录点击`回滚`按钮即可对升级操作进行回滚。

:::caution
注：在回滚的过程中，新增组件并不会被删除，如需变更，需要人为操作。
:::

-----------

## 附录1: 模版设置页面参数说明 {#template-setting}

### 1. 应用模版及发布版本设置

- 创建应用模版时参数说明：

| 选项名   | 说明                                                                         |
| -------- | ---------------------------------------------------------------------------- |
| 名称     | 定义应用名称（必填）                                                         |
| 发布范围 | 应用模板的可见范围，**当前团队**为当前团队可见，**企业**所有团队可见（必选） |
| 分类标签 | 应用标签，可按照架构、行业、部署方式进行分类                                 |
| 简介     | 应用描述，帮助使用者了解此应用                                               |
| Logo     | 应用的 Logo 图片                                                             |

- 创建应用模板后定义应用发布版本：

| 选项名   | 说明                                                                                                                           |
| -------- | ------------------------------------------------------------------------------------------------------------------------------ |
| 版本号   | 当同应用多次发布时，如果版本号相同，则会覆盖已发布的版本，如果不同，将发布为新版本，应用升级或回滚时，平台根据版本判断（必填） |
| 版本别名 | 应用别名，例如 高级版，初级版                                                                                                  |
| 版本说明 | 当前发布版本的说明，可区分不同版本的功能差异等信息                                                                             |
| 作为插件 | 当该应用模版下有插件时，选中该选项，则可以在`团队页面-插件-从本地组件库安装`，直接安装对应的插件而不安装应用                             |

### 2. 发布组件模型配置：

| 选项名   | 说明                                                                 |
| -------- | -------------------------------------------------------------------- |
| 连接信息 | 当连接信息中出现密码类的信息，可选择每次部署时自动生成随机值         |
| 环境变量 | 编辑该组件默认的环境变量                                             |
| 伸缩规则 | 定义该组件可伸缩的最大最小节点数，及节点伸缩步长，最小安装内存限制。 |

### 3. 发布插件模型信息：

要发布的应用中其组件携带有插件时，会进行展示并在发布过程中跟随组件发布。

### 4. K8s 资源：

要发布的应用中存在定义好的 K8s 资源时，也会进行展示并在发布过程中跟随应用发布。

所有信息配置完毕后，点击**提交**按钮进行发布，业务开发过程中定义的组件间依赖关系、环境配置、持久化存储、插件、运行环境及上述定义的所有信息都将会被打包发布。
