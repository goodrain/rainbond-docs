---
title: 基于源码的持续交付
---

<!-- （代码分支管理、开发测试环境生产流程） -->

## 部署和交付发展历程

部署指的是将代码运行到各种环境，以供开发和测试。交付则指的是软件产品在测试验收通过后，具备发布到生产环境交付给客户使用的条件。

部署和交付大致有以下三个发展阶段：`手动部署->自动化部署->持续交付`

<details>
<summary>1. 手动部署阶段</summary>

在手动部署阶段，往往需要用户手动获取最新源代码、编译、再针对环境修改很多配置。当服务数量较多时，编译就会耗费很长的时间。同时每个服务都有自己的配置。在开发环境和生产环境往往需要根据环境手工调整大量的配置。但这样很容易遗漏一些配置，导致程序无法正常运行，出问题后也很可能会直接在线上环境修复 Bug，导致更大的问题。

随着流程的规范，开发者在每次上线前写好部署文档和需要检查的配置项。运维人员按照部署文档一步步部署生产环境。这样确实有效减少了配置错误等问题，但整个部署过程还是很繁琐，尤其是服务器一多，耗时很长，仍然可能会因为人工操作错误导致失败。

</details>

<details>
<summary>2. 自动化部署阶段</summary>

手动部署的复杂性最终倒逼用户构建自己的自动化部署环境。早期的自动化部署解决方案是每日构建（Daily Build），简单来说，就是大家在每天晚上下班后，每日构建程序自动从源代码管理器下载最新代码，编译、部署程序到测试环境。这样第二天测试人员就可以拿到最新的程序，对前一天修复的 Bug 进行测试。

每日构建是个很大的进步，因为初步实现了自动化对代码进行编译、部署测试环境。但也有一些不完善的地方，比如说如果有开发人员提交的代码有问题，可能会导致当天的编译或部署失败，那么第二天开发人员上班后，还需要手动解决。

你会发现，自动化逐步应用到运维领域，确实是让部署过程更容易，但也只是让部署过程更容易，还是无法解决发布版本的质量问题，还是可能会因为配置错误导致失败，测试环境正常的功能到生产环境就不工作了。

</details>

<details>
<summary>3. 持续交付阶段</summary>

在完成了自动化部署以后，我们就可以实现这样的自动化部署流程，当代码合并到开发分支后，自动化测试、打包并部署到测试环境中。当测试都通过后，合并到主干分支，人工确认后，部署到生产环境。这样就实现了基于源码的持续交付流程。

</details>

## 如何实现源码持续交付？

### 准备工作

首先我们需要有源代码管理工具，比如说 git、svn，因为自动化部署需要从统一的源代码仓库获取代码进行构建和部署。

持续交付相对比部署要求更高，因为整个过程需要高度的自动化。要实现持续交付，你的项目需要满足以下条件：

- 对代码构建的过程可以反复进行，并且每次构建的结果是一致的、稳定的；

- 所有环境的配置都存在于源代码管理工具中，不仅仅是代码；

- 需要自动创建针对于不同环境的发布包；

- 所有环境的部署发布步骤都必须是自动化的。

上面这些要求，最难的部分其实就是自动化打包和自动化部署到各种环境，因为每套程序都不一样，每个服务器环境也不一样，而这些在 Rainbond 中可以得到很好解决。

## 操作流程

<!-- 在开发过程中，搭建环境是一个很繁琐的事情。对一个处于快速迭代过程中的产品而言，我们至少需要开发环境、测试环境、生产环境。对于代码而言，我们通常可以 Fork 出多个分支，来区分不同环境即可。通过定义流水线，也可以实现不同代码分支打包不同的镜像 tag。

但是到了搭建环境这一步，我们往往需要先定义 Yaml 模版或编写 Helm Chart，最后再根据不同的环境调整脚本和配置。当业务需要一些存储相关的能力或添加其他参数时，还需再次调整各类参数。整体流程复杂且繁琐，对用户的要求极高。

在 Rainbond 中，一开始搭建开发环境即可通过源码一键部署，只需提供源码地址即可。基于应用市场的中间件或其他模块，一键安装，通过拖拉拽的模式则可以快速搭建起一个可用环境。

在开发环境开发测试完成后，代码合并到生产分支以后，基于 Rainbond 的应用复制功能，可以一键复制出一套完整的生产环境，只需要在页面调整对应的镜像地址或源码分支，即可像Fork一份代码一样，复制出多套应用。在这期间，用户不需要关注底层的基础设施，以及 Yaml 文件或 Helm Chart 的编写。即可快速完成新环境的搭建。 -->
